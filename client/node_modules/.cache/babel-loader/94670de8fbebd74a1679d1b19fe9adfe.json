{"ast":null,"code":"import _regeneratorRuntime from\"/Users/phillipyang/Desktop/Nasa-Images-v4/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/phillipyang/Desktop/Nasa-Images-v4/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/phillipyang/Desktop/Nasa-Images-v4/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/phillipyang/Desktop/Nasa-Images-v4/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/phillipyang/Desktop/Nasa-Images-v4/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/phillipyang/Desktop/Nasa-Images-v4/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from\"react\";import ErrorPage from\"./ErrorPage\";import Loading from\"./Loading\";import{NavLink}from\"react-router-dom\";import{formatDisplayDate}from\"./Formatting\";import{fetchRover,fetchAPOD}from\"./NasaAPIs\";import CommentBox from\"./CommentBox\";import{removePhotoNotification,updateCommentNotification,deleteCommentNotification}from\"./Notifications\";import PopupWarning from\"./PopupWarning\";import DocumentTitle from\"react-document-title\";import axios from'axios';var API=\"https://itp404-final-project-yangphil.herokuapp.com/api/favorites\";var EditFavorite=/*#__PURE__*/function(_React$Component){_inherits(EditFavorite,_React$Component);var _super=_createSuper(EditFavorite);function EditFavorite(props){var _this;_classCallCheck(this,EditFavorite);_this=_super.call(this,props);_this.componentDidMount=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var acc,response,rawPhoto,nasaRes;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this.setState({loading:true});acc={_id:_this.props.location.state.email,data:{_id:_this.state.id}};_context.next=4;return axios.post(\"http://localhost:5000/account/favorites/\".concat(_this.props.location.state.api,\"/fetch\"),acc);case 4:response=_context.sent;if(!(response.status===200)){_context.next=21;break;}_this.setState({photo:response.data,idExists:true});if(response.data.comment||!response.data.comment.trim()){_this.setState({comment:response.data.comment});}else{_this.setState({comment:\"\"});}if(!(_this.props.location.state.api===\"apod\")){_context.next=15;break;}_context.next=11;return fetchAPOD(response.data.date);case 11:rawPhoto=_context.sent;_this.setState({rawPhoto:rawPhoto});_context.next=19;break;case 15:_context.next=17;return fetchRover(response.data.date);case 17:nasaRes=_context.sent;nasaRes.map(function(photo){if(photo.id===response.data.array_id){_this.setState({rawPhoto:photo});}});case 19:_context.next=22;break;case 21:_this.setState({idExists:false});case 22:_this.setState({loading:false});case 23:case\"end\":return _context.stop();}}},_callee);}));_this.toggleLike=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.delete(\"http://localhost:5000/account/favorites/\".concat(_this.state.photo.api,\"/delete\"),{// for delete, all data must be wrapped in data\ndata:{_id:_this.props.location.state.email,data:{_id:_this.state.photo._id}}}).then(function(response){// console.log(response);\n}).catch(function(err){// console.log(\"didn't delete\");\n});case 2:_this.setState({liked:!_this.state.liked});removePhotoNotification(_this.state.photo._id);_this.setState({hidePopup:true});_this.props.history.push({pathname:'/favorites',state:{email:_this.props.location.state.email}});case 6:case\"end\":return _context2.stop();}}},_callee2);}));_this.lastTap=null;_this.handleDoubleTap=function(){var now=Date.now();var DOUBLE_PRESS_DELAY=300;if(_this.lastTap&&now-_this.lastTap<DOUBLE_PRESS_DELAY){_this.openWarning();}else{_this.lastTap=now;}};_this.handleCommentUpdate=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(newComment){var id;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:id=_this.state.photo._id;if(!newComment.trim()){newComment=\"\";deleteCommentNotification(id);}else{updateCommentNotification(id);}_this.setState({comment:newComment});axios.post(\"http://localhost:5000/account/favorites/\".concat(_this.state.photo.api,\"/edit\"),{_id:_this.props.location.state.email,data:{_id:id,comment:newComment}});// if (this.state.photo.api === \"mars\") {\n//   await fetch(`${API}/mars/${id}`, {\n//     method: \"PUT\",\n//     headers: { \"Content-Type\": \"application/json \" },\n//     body: JSON.stringify({\n//       comment: newComment\n//     })\n//   });\n// } else {\n//   await fetch(`${API}/apod/${id}`, {\n//     method: \"PUT\",\n//     headers: { \"Content-Type\": \"application/json \" },\n//     body: JSON.stringify({\n//       comment: newComment\n//     })\n//   });\n// }\ncase 4:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x){return _ref3.apply(this,arguments);};}();_this.openWarning=function(){_this.setState({hidePopup:false});};_this.handleWarning=function(option){if(option===\"ok\"){_this.toggleLike();}else{_this.setState({hidePopup:true});}};_this.state={id:_this.props.match.params.id,idExists:false,loading:false,photo:{},// photo is the JSON data from my api\nrawPhoto:{},// rawPhoto is the actual JSON data from nasa api\nliked:true,comment:\"Click to add a comment\",// default comment\ndeleteConfirmed:false,hidePopup:true};return _this;}_createClass(EditFavorite,[{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(DocumentTitle,{title:\"Edit Favorite\"},/*#__PURE__*/React.createElement(\"div\",{id:\"singlePhotoPage\",onClick:this.props.onClick},/*#__PURE__*/React.createElement(PopupWarning,{hide:this.state.hidePopup,text:\"Remove from Favorites?\",handlePopup:this.handleWarning,email:this.props.location.state.email}),this.state.loading?/*#__PURE__*/React.createElement(Loading,null):/*#__PURE__*/React.createElement(\"div\",null,this.state.idExists===false?/*#__PURE__*/React.createElement(ErrorPage,{url:this.props.location.pathname}):/*#__PURE__*/React.createElement(\"div\",{className:\"container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(NavLink,{to:{pathname:\"/favorites\",state:{email:this.props.location.state.email}}},/*#__PURE__*/React.createElement(\"a\",{id:\"back-button\",href:\"\",className:\"btn col-12\"},/*#__PURE__*/React.createElement(\"i\",{className:\"icon-circle-arrow-left\"})))),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-lg-7 col-md-7 col-sm-12 single-photo\"},/*#__PURE__*/React.createElement(\"img\",{className:\"col-12\",src:this.state.photo.url,alt:this.state.photo.comment,onClick:this.handleDoubleTap})),/*#__PURE__*/React.createElement(\"div\",{className:\"col-lg-5 col-md-5 col-sm-12 single-photo-details\"},this.state.photo.api===\"mars\"?/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h2\",null,\"Details\"),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Date Taken: \"),formatDisplayDate(this.state.rawPhoto.earth_date)),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Rover: \"),this.state.rawPhoto.rover.name),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Camera: \"),this.state.rawPhoto.camera.full_name),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Launch Date: \"),formatDisplayDate(this.state.rawPhoto.rover.launch_date)),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Landing Date: \"),formatDisplayDate(this.state.rawPhoto.rover.landing_date)),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Status: \"),this.state.rawPhoto.rover.status),/*#__PURE__*/React.createElement(\"p\",{className:\"icon-holder\",onClick:this.openWarning},/*#__PURE__*/React.createElement(\"img\",{src:this.state.liked?require(\"./images/filledHeart.png\"):require(\"./images/emptyHeart.png\"),className:\"heart-icon\",alt:\"heart icon\"})),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Comment:\")),/*#__PURE__*/React.createElement(\"div\",{className:\"margin-top-20\"},/*#__PURE__*/React.createElement(CommentBox,{value:this.state.comment,onEnter:this.handleCommentUpdate}))):/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"p\",{id:\"apod-date\"},formatDisplayDate(this.state.rawPhoto.date)),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,this.state.rawPhoto.title)),/*#__PURE__*/React.createElement(\"p\",null,this.state.rawPhoto.explanation),this.state.rawPhoto.copyright?/*#__PURE__*/React.createElement(\"p\",null,\"Credit: \",this.state.rawPhoto.copyright):/*#__PURE__*/React.createElement(\"p\",null)))),this.state.photo.api===\"apod\"?/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"col-12 apod-details\"},/*#__PURE__*/React.createElement(\"p\",{className:\"icon-holder\",onClick:this.openWarning},/*#__PURE__*/React.createElement(\"img\",{src:this.state.liked?require(\"./images/filledHeart.png\"):require(\"./images/emptyHeart.png\"),className:\"heart-icon\",alt:\"heart icon\"})),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Comment:\")),/*#__PURE__*/React.createElement(CommentBox,{value:this.state.comment,onEnter:this.handleCommentUpdate}))):/*#__PURE__*/React.createElement(\"div\",null)))));}}]);return EditFavorite;}(React.Component);export{EditFavorite as default};","map":{"version":3,"sources":["/Users/phillipyang/Desktop/Nasa-Images-v4/client/src/EditFavorite.js"],"names":["React","ErrorPage","Loading","NavLink","formatDisplayDate","fetchRover","fetchAPOD","CommentBox","removePhotoNotification","updateCommentNotification","deleteCommentNotification","PopupWarning","DocumentTitle","axios","API","EditFavorite","props","componentDidMount","setState","loading","acc","_id","location","state","email","data","id","post","api","response","status","photo","idExists","comment","trim","date","rawPhoto","nasaRes","map","array_id","toggleLike","delete","then","catch","err","liked","hidePopup","history","push","pathname","lastTap","handleDoubleTap","now","Date","DOUBLE_PRESS_DELAY","openWarning","handleCommentUpdate","newComment","handleWarning","option","match","params","deleteConfirmed","onClick","url","earth_date","rover","name","camera","full_name","launch_date","landing_date","require","title","explanation","copyright","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport ErrorPage from \"./ErrorPage\";\nimport Loading from \"./Loading\";\nimport { NavLink } from \"react-router-dom\";\nimport { formatDisplayDate } from \"./Formatting\";\nimport { fetchRover, fetchAPOD } from \"./NasaAPIs\";\nimport CommentBox from \"./CommentBox\";\nimport {\n  removePhotoNotification,\n  updateCommentNotification,\n  deleteCommentNotification\n} from \"./Notifications\";\nimport PopupWarning from \"./PopupWarning\";\nimport DocumentTitle from \"react-document-title\";\nimport axios from 'axios';\n\nconst API = \"https://itp404-final-project-yangphil.herokuapp.com/api/favorites\";\n\nexport default class EditFavorite extends React.Component {\n  constructor(props) {\n    super(props);\n    \n    this.state = {\n      id: this.props.match.params.id,\n      idExists: false,\n      loading: false,\n      photo: {}, // photo is the JSON data from my api\n      rawPhoto: {}, // rawPhoto is the actual JSON data from nasa api\n      liked: true,\n      comment: \"Click to add a comment\", // default comment\n      deleteConfirmed: false,\n      hidePopup: true\n    };\n  }\n  componentDidMount = async () => {\n    this.setState({ loading: true });\n    \n    const acc = {\n      _id: this.props.location.state.email,\n      data: {\n        _id: this.state.id\n      }\n    }\n    let response = await axios.post(`http://localhost:5000/account/favorites/${this.props.location.state.api}/fetch`, acc);\n    \n    if(response.status === 200) {\n      this.setState({ photo: response.data, idExists: true });\n      if (response.data.comment || !response.data.comment.trim()) {\n        this.setState({ comment: response.data.comment });\n      } else {\n        this.setState({ comment: \"\" });\n      }\n      if(this.props.location.state.api === \"apod\") {\n        const rawPhoto = await fetchAPOD(response.data.date);\n        this.setState({ rawPhoto });\n      } else {\n        const nasaRes = await fetchRover(response.data.date);\n          nasaRes.map(photo => {\n            if (photo.id === response.data.array_id) {\n              this.setState({ rawPhoto: photo });\n            } \n          });\n      } \n    } else {\n      this.setState({ idExists: false });\n    }\n    this.setState({ loading: false });\n  }\n\n  toggleLike = async () => {\n    await axios.delete(`http://localhost:5000/account/favorites/${this.state.photo.api}/delete`, {\n\t\t\t\t// for delete, all data must be wrapped in data\n        data: {\n\t\t\t\t\t_id: this.props.location.state.email,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\t_id: this.state.photo._id\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(response => {\n\t\t\t\t// console.log(response);\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\t// console.log(\"didn't delete\");\n\t\t\t});\n  \n    this.setState({ liked: !this.state.liked });\n    removePhotoNotification(this.state.photo._id);\n    this.setState({ hidePopup: true });\n    this.props.history.push({\n      pathname: '/favorites',\n      state: {\n        email: this.props.location.state.email\n      }\n    });\n  }\n\n  lastTap = null;\n  handleDoubleTap = () => {\n    const now = Date.now();\n    const DOUBLE_PRESS_DELAY = 300;\n    if (this.lastTap && now - this.lastTap < DOUBLE_PRESS_DELAY) {\n      this.openWarning();\n    } else {\n      this.lastTap = now;\n    }\n  };\n  handleCommentUpdate = async newComment => {\n    const id = this.state.photo._id;\n    if (!newComment.trim()) {\n      newComment = \"\";\n      deleteCommentNotification(id);\n    } else {\n      updateCommentNotification(id);\n    }\n    this.setState({ comment: newComment });\n    axios.post(`http://localhost:5000/account/favorites/${this.state.photo.api}/edit`, {\n      _id: this.props.location.state.email,\n      data: {\n        _id: id,\n        comment: newComment\n      }\n    });\n    // if (this.state.photo.api === \"mars\") {\n    //   await fetch(`${API}/mars/${id}`, {\n    //     method: \"PUT\",\n    //     headers: { \"Content-Type\": \"application/json \" },\n    //     body: JSON.stringify({\n    //       comment: newComment\n    //     })\n    //   });\n    // } else {\n    //   await fetch(`${API}/apod/${id}`, {\n    //     method: \"PUT\",\n    //     headers: { \"Content-Type\": \"application/json \" },\n    //     body: JSON.stringify({\n    //       comment: newComment\n    //     })\n    //   });\n    // }\n  };\n  openWarning = () => {\n    this.setState({ hidePopup: false });\n  };\n  handleWarning = option => {\n    if (option === \"ok\") {\n      this.toggleLike();\n    } else {\n      this.setState({ hidePopup: true });\n    }\n  };\n  render() {\n    return (\n      <DocumentTitle title=\"Edit Favorite\">\n        <div id=\"singlePhotoPage\" onClick={this.props.onClick}>\n          <PopupWarning\n            hide={this.state.hidePopup}\n            text=\"Remove from Favorites?\"\n            handlePopup={this.handleWarning}\n            email={this.props.location.state.email}\n          />\n          {this.state.loading ? (\n            <Loading />\n          ) : (\n            <div>\n              {this.state.idExists === false ? (\n                <ErrorPage url={this.props.location.pathname} />\n              ) : (\n                <div className=\"container\">\n                  <div className=\"row\">\n                    <NavLink to={{\n                      pathname: \"/favorites\",\n                      state: {\n                        email: this.props.location.state.email\n                      }\n                    }}>\n                      <a id=\"back-button\" href=\"\" className=\"btn col-12\"><i className=\"icon-circle-arrow-left\"></i></a>\n                    </NavLink>\n                  </div>\n                  <div className=\"row\">\n                    <div className=\"col-lg-7 col-md-7 col-sm-12 single-photo\">\n                      <img\n                        className=\"col-12\"\n                        src={this.state.photo.url}\n                        alt={this.state.photo.comment}\n                        onClick={this.handleDoubleTap}\n                      />\n                    </div>\n                    <div className=\"col-lg-5 col-md-5 col-sm-12 single-photo-details\">\n                      {this.state.photo.api === \"mars\" ? (\n                        <div>\n                          <h2>Details</h2>\n                          <p>\n                            <strong>Date Taken: </strong>\n                            {formatDisplayDate(this.state.rawPhoto.earth_date)}\n                          </p>\n                          <p>\n                            <strong>Rover: </strong>\n                            {this.state.rawPhoto.rover.name}\n                          </p>\n                          <p>\n                            <strong>Camera: </strong>\n                            {this.state.rawPhoto.camera.full_name}\n                          </p>\n                          <p>\n                            <strong>Launch Date: </strong>\n                            {formatDisplayDate(\n                              this.state.rawPhoto.rover.launch_date\n                            )}\n                          </p>\n                          <p>\n                            <strong>Landing Date: </strong>\n                            {formatDisplayDate(\n                              this.state.rawPhoto.rover.landing_date\n                            )}\n                          </p>\n                          <p>\n                            <strong>Status: </strong>\n                            {this.state.rawPhoto.rover.status}\n                          </p>\n                          {/* <div className=\"icon-holder\" onClick={this.toggleLike}>\n                                                    <img\n                                                        src={this.state.liked ? require('./images/filledHeart.png') : require('./images/emptyHeart.png')}\n                                                        className=\"heart-icon\"\n                                                        alt=\"heart icon\"\n                                                    />\n                                                </div> */}\n                          <p className=\"icon-holder\" onClick={this.openWarning}>\n                            <img\n                              src={\n                                this.state.liked\n                                  ? require(\"./images/filledHeart.png\")\n                                  : require(\"./images/emptyHeart.png\")\n                              }\n                              className=\"heart-icon\"\n                              alt=\"heart icon\"\n                            />\n                          </p>\n                          <p>\n                            <strong>Comment:</strong>\n                          </p>\n                          <div className=\"margin-top-20\">\n                            <CommentBox\n                              value={this.state.comment}\n                              onEnter={this.handleCommentUpdate}\n                            />\n                          </div>\n                        </div>\n                      ) : (\n                        <div>\n                          <p id=\"apod-date\">\n                            {formatDisplayDate(this.state.rawPhoto.date)}\n                          </p>\n                          <p>\n                            <strong>{this.state.rawPhoto.title}</strong>\n                          </p>\n                          <p>{this.state.rawPhoto.explanation}</p>\n                          {this.state.rawPhoto.copyright ? (\n                            <p>Credit: {this.state.rawPhoto.copyright}</p>\n                          ) : (\n                            <p></p>\n                          )}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                  {this.state.photo.api === \"apod\" ? (\n                    <div>\n                      <div className=\"col-12 apod-details\">\n                        <p className=\"icon-holder\" onClick={this.openWarning}>\n                          <img\n                            src={\n                              this.state.liked\n                                ? require(\"./images/filledHeart.png\")\n                                : require(\"./images/emptyHeart.png\")\n                            }\n                            className=\"heart-icon\"\n                            alt=\"heart icon\"\n                          />\n                        </p>\n                        <p>\n                          <strong>Comment:</strong>\n                        </p>\n                        <CommentBox\n                          value={this.state.comment}\n                          onEnter={this.handleCommentUpdate}\n                        />\n                      </div>\n                    </div>\n                  ) : (\n                    <div />\n                  )}\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n      </DocumentTitle>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}